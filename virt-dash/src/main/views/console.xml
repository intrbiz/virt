<!DOCTYPE balsa SYSTEM "http://balsa.intrbiz.net/balsa.dtd">
<?RenderLibrary com.intrbiz.balsa?>
<!-- The console view -->
<html xmlns="com.intrbiz.balsa">
	<head>
		<title>Virt Dash - Guest #{guest.name} console</title>
		<link rel="stylesheet" href="/novnc/include/base.css" title="plain"/>
		<script src="/novnc/include/util.js"></script>
	</head>
	<body>

	<div id="noVNC_screen">
		<div id="noVNC_status_bar" class="noVNC_status_bar" style="margin-top: 0px;">
			<table border="0" width="100%">
				<tr>
					<td>
						<div id="noVNC_status" style="position: relative; height: auto;">Loading</div>
					</td>
				</tr>
			</table>
		</div>
		<canvas id="noVNC_canvas" width="640px" height="20px">Canvas not supported.</canvas>
	</div>
    
	<script>
		/* <![CDATA[ */
		var INCLUDE_URI = "/novnc/include/";
		Util.load_scripts([
			"webutil.js", 
			"base64.js", 
			"websock.js", 
			"des.js", 
			"input.js", 
			"display.js", 
			"jsunzip.js", 
			"rfb.js"
		]);
		
		function updateState(rfb, state, oldstate, msg) {
		    var s, sb, level;
		    s = $D('noVNC_status');
		    sb = $D('noVNC_status_bar');
		    switch (state)
		    {
		        case 'failed':       level = "error";  break;
		        case 'fatal':        level = "error";  break;
		        case 'normal':       level = "normal"; break;
		        case 'disconnected': level = "normal"; break;
		        case 'loaded':       level = "normal"; break;
		        default:             level = "warn";   break;
		    }
		    if (typeof(msg) !== 'undefined')
		    {
		        sb.setAttribute("class", "noVNC_status_" + level);
		        s.innerHTML = msg;
		    }
		}
		
		window.onscriptsload = function () {		
		    WebUtil.init_logging(WebUtil.getQueryVar('logging', 'warn'));		
		    (new RFB({
		    	'target':       $D('noVNC_canvas'),
		        'encrypt':      false,
		        'repeaterID':   '',
		        'true_color':   true,
		        'local_cursor': true,
		        'shared':       true,
		        'view_only':    false,
		        'updateState':  updateState,
		        'connectTimeout': 30
		    })).connect(#{'"' + host.address + '"'}, #{'"' + guest.vncWebsocketPort + '"'}, '', '');
		};
		/* ]]> */
	</script>
	
	</body>
</html>